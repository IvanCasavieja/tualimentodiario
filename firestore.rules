rules_version = '2';
service cloud.firestore {
  match /databases/{db}/documents {

    // --- helper: función para validar usuarios específicos (Iván + Maxi) ---
    function isAdmin() {
      return request.auth != null &&
             request.auth.uid in [
               "Hw70VMXycgXgLKow2EIAjFU9h8p1", // Iván
               "8Z5t5CqqO9XLqSWhzNI0AnMjkPF2"  // Maxi
             ];
    }

    // --- colección dailyFoods ---
    match /dailyFoods/{docId} {
      // cualquiera puede leer
      allow read: if true;

      // solo Iván o Maxi pueden escribir, actualizar o borrar
      allow create, update, delete: if isAdmin();
    }

    // --- colección users ---
    match /users/{uid} {
      // cada usuario puede leer y modificar su propio perfil
      allow read, create, update, delete: if request.auth != null && request.auth.uid == uid;

      // subcolección favoritos
      match /favorites/{foodId} {
        allow read, create, delete: if request.auth != null && request.auth.uid == uid;
        allow update: if false;
      }
    }

    // --- colección admins (si la dejás para lectura futura) ---
    match /admins/{uid} {
      allow read: if isAdmin();
      allow write: if false;
    }

    // --- colección userFeedback ---
    match /userFeedback/{docId} {
      // cualquier usuario autenticado puede enviar feedback
      allow create: if request.auth != null;
      // solo administradores pueden leer o modificar feedbacks
      allow read, update, delete: if isAdmin();
    }

    // --- catch-all (deny by default) ---
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
